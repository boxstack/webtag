@{
  Page.Title = "Add Item";  


  string appDatabaseName = App.appDatabaseName;
  var id = "";
  var tag = "";
  var po = "";
  var desc = "";
  var serno = "";
  var model = "";
  var appby = "";
  var appdate = "";
  var cost = "";
  var acquired = "";

  if ( !Request.QueryString["tag"].IsEmpty() ) {
    tag = Request.QueryString["tag"];
  }

  if ( IsPost ) {
    Validation.Add( "tag",
      Validator.Required( "Please specify the tag" ),
      Validator.Regex( @"^\d{4}$", "Tag must be four (4) digits" )
    );
    Validation.Add( "desc",
      Validator.Required( "An item description is required" )
    );
    Validation.Add( "serno",
      Validator.Required( "Please provide the item serial number" )
    );
    Validation.Add( "model",
      Validator.Required( "The item model is required" )
    );
    Validation.Add( "appdate",
      Validator.DateTime( "If provided, date must be valid (MM/DD/YYYY)" )
    );
    Validation.Add( "cost",
      Validator.Decimal( "If provided, cost must be decimal" )
    );
    Validation.Add( "acquired",
      Validator.DateTime( "If provided, date must be valid (MM/DD/YYYY)" )
    );

    tag = Request.Form["tag"];
    po = Request.Form["po"];
    desc = Request.Form["desc"];
    serno = Request.Form["serno"];
    model = Request.Form["model"];
    appby = Request.Form["appby"];
    appdate = Request.Form["appdate"];  
    cost = Request.Form["cost"];
    acquired = Request.Form["acquired"];

    if ( !Request["buttonAdd"].IsEmpty() && Validation.IsValid() ) {
      var db = Database.Open( appDatabaseName );
      var selectCommand = "SELECT * FROM Items WHERE Tag = @0";
      var existingItem = db.QuerySingle( selectCommand, tag );

      if ( existingItem != null ) {
        Response.Redirect( "~/EditItem?id=" + existingItem.ID + "&tag=" + tag );        
      } else {
        var insertCommand = "INSERT INTO " +
                            "Items (Tag, PONumber, Description, SerialNumber, " +
                            "Model, AppliedBy, Cost) " +
                            "VALUES (@0, @1, @2, @3, @4, @5, @6)";
        db.Execute( insertCommand, tag, po, desc, serno, model, appby, cost );

        var updateCommand = "";

        if ( acquired.Length > 0 ) {
          updateCommand = "UPDATE Items SET " +
                          "Acquired=@0 " +
                          "WHERE Tag=@1";
          db.Execute( updateCommand, acquired, tag );
        }

        if ( appdate.Length > 0 ) {
          updateCommand = "UPDATE Items SET " +
                          "AppliedByDate=@0 " +
                          "WHERE Tag=@1";
          db.Execute( updateCommand, appdate, tag );
        }

        Response.Redirect( "~/Items?tag=" + tag );
      }
    }
  }
}

<!-- <html> from layout -->
  <!-- <body> from layout -->
    <h2>Add an Item</h2>
    @Html.ValidationSummary()
    <p>
      <a href="~/Items">Return to Items</a>
    </p>

    <form method="post">
      <fieldset>
        <legend>Item Information</legend>

        <div>
          <label for="tag">Tag:</label>
          <input type="text" name="tag" value="@tag" @Validation.For("tag") />
          @Html.ValidationMessage( "tag" )
          <br />
        </div>

        <div>
          <label for="po">PO Number:</label>
          <input type="text" name="po" value="@po" />
          <br />
        </div>

        <div>
          <label for="cost">Cost:</label>
          <input type="text" name="cost" value="@cost" @Validation.For("cost") />
          @Html.ValidationMessage( "cost" )
          <br />
        </div>

        <div>
          <label for="acquired">Acquired:</label>
          <input type="text" name="acquired" value="@acquired" @Validation.For("acquired") />
          @Html.ValidationMessage( "acquired" )
          <br />
        </div>

        <div>
          <label for="desc">Description:</label>
          <input type="text" name="desc" value="@desc" @Validation.For("desc") />
          @Html.ValidationMessage( "desc" )
          <br />
        </div>

        <div>
          <label for="serno">Serial Number:</label>
          <input type="text" name="serno" value="@serno" @Validation.For("serno")  />
          @Html.ValidationMessage( "serno" )
          <br />
        </div>

        <div>
          <label for="model">Model:</label>
          <input type="text" name="model" value="@model" @Validation.For("model") />
          @Html.ValidationMessage( "model")
          <br />
        </div>

        <div>
          <label for="appby">Tag Applied By:</label>
          <input type="text" name="appby" value="@appby" />
          <br />
        </div>

        <div>
          <label for="appdate">Date Applied:</label>
          <input type="text" name="appdate" value="@appdate" @Validation.For("appdate") />
          @Html.ValidationMessage( "appdate" )
          <br />
        </div>

        <div>
          <input type="submit" name="buttonAdd" value="Add Item" class="submitbutton" />
        </div>
      </fieldset>
    </form>